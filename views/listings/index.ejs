<%= layout("/layouts/boilerplate") %>

<div class="page-header">
  <div>
    <h2 class="mb-1">
      <i class="fa-solid fa-compass text-brand me-2"></i> Explore stays
    </h2>
    <p class="text-muted mb-0">Discover amazing places to stay around the world</p>
  </div>
</div>

<div class="card ui-card mb-4">
  <div class="card-body">
    <form class="row g-3 align-items-end" method="GET" action="/listings">
      <div class="col-lg-4 col-md-6">
        <label class="form-label">
          <i class="fa-solid fa-location-dot text-brand me-1"></i> Location
        </label>
        <input class="form-control" name="location" placeholder="City or country" value="<%= q?.location || '' %>" />
      </div>
      <div class="col-lg-3 col-md-3">
        <label class="form-label">Min price</label>
        <input class="form-control" name="minPrice" type="number" placeholder="₹0" value="<%= q?.minPrice || '' %>" />
      </div>
      <div class="col-lg-3 col-md-3">
        <label class="form-label">Max price</label>
        <input class="form-control" name="maxPrice" type="number" placeholder="₹50,000" value="<%= q?.maxPrice || '' %>" />
      </div>
      <div class="col-lg-2 col-md-12 d-flex gap-2">
        <button class="btn btn-brand flex-grow-1" title="Search">
          <i class="fa-solid fa-magnifying-glass me-1"></i> Search
        </button>
        <a class="btn btn-outline-secondary" href="/listings" title="Reset">
          <i class="fa-solid fa-rotate-left"></i>
        </a>
      </div>
    </form>
  </div>
</div>

<% if (allListings && allListings.length === 0) { %>
  <div class="text-center py-5">
    <div class="mb-3">
      <i class="fa-solid fa-house-circle-xmark fa-4x text-muted"></i>
    </div>
    <h4 class="text-muted">No listings found</h4>
    <p class="text-muted">Try adjusting your search filters</p>
    <a href="/listings" class="btn btn-brand mt-2">View all listings</a>
  </div>
<% } else { %>
  <div class="row g-4">
    <% for(let listing of allListings){ %>
      <div class="col-lg-4 col-md-6">
        <a href="/listings/<%= listing._id %>" class="listing-link">
          <div class="card listing-card">
            <div class="listing-card-img-wrapper">
              <img class="card-img-top" src="<%= listing.image %>" alt="<%= listing.title %>" loading="lazy" />
            </div>
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start gap-2">
                <div>
                  <div class="listing-card-title"><%= listing.title %></div>
                  <div class="listing-card-location">
                    <i class="fa-solid fa-location-dot me-1"></i>
                    <%= listing.location %>, <%= listing.country %>
                  </div>
                </div>
                <span class="rating-pill" title="Rating">
                  <i class="fa-solid fa-star" style="color:#f59e0b"></i>
                  <%= (listing.ratingAverage || 0).toFixed(1) %>
                </span>
              </div>
              <div class="listing-card-price">
                <span class="price">₹<%= listing.price.toLocaleString("en-IN") %></span>
                <span class="unit">/night</span>
              </div>
            </div>
          </div>
        </a>
      </div>
    <% } %>
  </div>
<% } %>
